@model List<CartItem>

@{
    ViewData["Title"] = "Your Cart";
}

<h1>Your Cart</h1>
<a href="@Url.Action("Browse", "Products")">Back to Browse</a>

<div id="cart">
    @if (Model.Count > 0)
    {
        foreach (var item in Model)
        {
            <div class="cart-item">
                <h2>@item.Product.Name</h2>
                <p>Price: $@item.Product.Price</p>
                <p>Quantity:
                    <input type="number" value="@item.Quantity" min="1"
                           onchange="updateCart(@item.Product.Id, this.value)" />
                </p>
                <button onclick="removeFromCart(@item.Product.Id)">Remove</button>
            </div>
        }
    }
    else
    {
        <p>Your cart is empty.</p>
    }
</div>

@section Scripts {
<script>
    function updateCart(productId, quantity) {
        fetch('/Cart/Update', {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ productId, quantity })
        })
        .then(res => res.json())
        .then(data => {
            alert(data.message);
            location.reload();
        });
    }

    function removeFromCart(productId) {
        fetch('/Cart/Remove', {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ productId })
        })
        .then(res => res.json())
        .then(data => {
            alert(data.message);
            location.reload();
        });
    }
</script>
}
